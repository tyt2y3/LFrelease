define("F.core/css",{load:function(e,t,n,r){function i(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("link");n.href=e,n.rel="stylesheet",n.type="text/css",t.appendChild(n)}i(requirejs.toUrl(e)),n(!0)},pluginBuilder:"./css-build"}),define("F.core/css-embed",function(){function e(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("style"),r=document.createTextNode(e);n.type="text/css",n.styleSheet?n.styleSheet.cssText=r.nodeValue:n.appendChild(r),t.appendChild(n)}return e}),define("F.core/css!F.core/style.css",["F.core/css-embed"],function(e){return e(".F_sprite { position:absolute; overflow:hidden; width:10px; height:10px; } .F_sprite_inline { overflow:hidden; width:10px; height:10px; } .F_sprite_img { position:absolute; } .canvas { position:relative; width:800px; /*height:577px;*/ height:300px; border:1px solid #000; } .page { position: absolute; left: 0px; top: 0px; border: 1px solid #000; z-index: 10000; } "),!0}),define("F.core/support",[],function(){var e={};return function(){var t=navigator.userAgent.toLowerCase(),n=/(webkit)[ \/]([\w.]+)/.exec(t)||/(o)pera(?:.*version)?[ \/]([\w.]+)/.exec(t)||/(ms)ie ([\w.]+)/.exec(t)||/(moz)illa(?:.*? rv:([\w.]+))?/.exec(t)||[],r=/iPad|iPod|iPhone|Android|webOS|IEMobile/i.exec(t);e.mobile=r?r[0]:undefined,e.prefix=n[1]||n[0],e.prefix==="moz"&&(e.prefix="Moz"),e.prefix==="o"&&(e.prefix="O"),n[2]&&(e.version=+n[2].split(".")[0])}(),function(){e.css2dtransform=undefined,e.css3dtransform=undefined;var t=document.createElement("p"),n,r,i={WebkitTransform:"-webkit-transform",OTransform:"-o-transform",MSTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.getElementsByTagName("body")[0].appendChild(t);for(n in i)if(t.style[n]!==undefined){var s;s="matrix(1, 0, 0, 1, 0, 0)",t.style[n]=s,s===window.getComputedStyle(t).getPropertyValue(i[n])&&(e.css2dtransform=n),s="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)",t.style[n]=s,s===window.getComputedStyle(t).getPropertyValue(i[n])&&(e.css3dtransform=n)}t.parentNode.removeChild(t)}(),function(){var e=0,t=["ms","moz","webkit","o"];for(var n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),s=window.setTimeout(function(){t(r+i)},i);return e=r+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),e}),define("F.core/util",[],function(){var e={css:function(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("link");n.href=e,n.rel="stylesheet",n.type="text/css",t.appendChild(n)},double_delegate:function(e,t){return function(){e&&e.apply(this,Array.prototype.slice.call(arguments)),t&&t.apply(this,Array.prototype.slice.call(arguments))}},make_array:function(e){return e?e instanceof Array?e:[e]:[]},search_array:function(e,t,n,r){var i=new Array;for(var s in e)if(t(e[s],s)){n&&(e[s]=n(e[s]));if(!r)return s;i.push(s)}return r?i:-1},arr_search:function(t,n,r,i){return e.search_array(t,n,r,i)},push_unique:function(t,n){var r=e.arr_search(t,function(e){return e==n});if(r==-1)return t.push(n),!0},extend_object:function(e,t){for(var n in t)typeof t[n]=="object"?e[n]=arguments.callee(e[n]?e[n]:{},t[n]):e[n]=t[n];return e},to_text:function(e,t,n,r,i,s){if(s===0)return"";s||(s=30),n||(n="\n"),r||(r="");var o=r+t+":"+n;o+=r+"{";var u=0;for(var a in e){var f=i&&i(a,e[a]);f!=1&&(typeof f=="string"?o+=(u?",":"")+n+r+"	"+"'"+a+"'"+": "+f:e[a].constructor==Object?o+=(u?",":"")+n+arguments.callee(e[a],a,n,r+"	",i,s-1):(o+=(u?",":"")+n+r+"	"+"'"+a+"'"+": ",typeof e[a]=="string"&&(o+="'"),o+=e[a],typeof e[a]=="string"&&(o+="'"))),u=1}return o+=n+r+"}",o},extract_array:function(t,n){var r={};n=e.make_array(n);for(var i in n)r[n[i]]=[];for(var s=0;s<t.length;s++)for(var o=0;o<n.length;o++){var u=n[o];r[u].push(t[s][u])}return r},group_elements:function(e,t){var n={};for(var r=0;r<e.length;r++){var i=e[r][t];n[i]||(n[i]=[]),n[i].push(e[r])}return n},for_each:function(e,t){if(e instanceof Array)for(var n=0;n<e.length;n++)t(e[n],n);else if(e)for(var r in e)t(e[r])},call_each:function(e,t){var n=Array.prototype.slice.call(arguments,2);if(e instanceof Array)for(var r=0;r<e.length;r++)typeof e[r][t]=="function"&&e[r][t].apply(null,n);else if(e)for(var r in e)typeof e[r][t]=="function"&&e[r][t].apply(null,n)}};return e}),define("F.core/resourcemap",["F.core/util"],function(e){function t(t){this.map=e.make_array(t);for(var r=0;r<this.map.length;r++)this.map[r]=new n(this.map[r])}function n(e){this.map=e,this.update_condition()}return t.prototype.update_condition=function(){e.call_each(this.map,"update_condition")},t.prototype.get=function(e){var t;for(var n=0;n<this.map.length;n++){t=this.map[n].get(e);if(t)break}return t||e},n.prototype.update_condition=function(){this.map.condition?this.enable=this.map.condition()||!1:this.enable=!0,typeof this.map.resource!="object"&&typeof this.map.get!="function"&&(this.enable=!1)},n.prototype.get=function(e){if(this.enable){if(this.map.resource&&this.map.resource[e])return this.map.resource[e];var t=this.map.get&&this.map.get(e);if(t)return t}return null},t}),define("F.core/sprite",["F.core/css!F.core/style.css","F.core/support","F.core/resourcemap","module"],function(e,t,n,r){function o(e){this.ID=i,i++,e.div?(this.el=e.div,this.el.className?this.el.className+=" F_sprite_inline":this.el.className="F_sprite_inline",window.getComputedStyle(this.el).getPropertyValue("position")==="static"&&(this.el.style.position="relative")):(this.el=document.createElement("div"),this.el.className="F_sprite",e.canvas.appendChild(this.el)),this.img={},this.cur_img=null,this.set_wh(e.wh);if(e.img)if(typeof e.img=="object")for(var n in e.img)this.add_img(e.img[n],n);else this.add_img(e.img,"0");if(e.div){var r=e.div.getElementsByTagName("img");for(var s=0;s<r.length;s++){var o=r[s].getAttribute("name");o&&this.adopt_img(r[s])}}t.css2dtransform&&!e.div&&(this.el.style.left="0px",this.el.style.top="0px")}var i=0,s=r.config()||{};return o.masterconfig=o.prototype.masterconfig=function(e){if(!e)return s;s=e,o.masterconfig_update()},o.masterconfig_set=o.prototype.masterconfig_set=function(e,t){e&&t&&(s[e]=t,o.masterconfig_update())},o.masterconfig_update=function(){s.resourcemap&&(s.resourcemap instanceof n||(s.resourcemap=new n(s.resourcemap)))},o.resolve_resource=function(e){return s.resourcemap?s.resourcemap.get(e):s.baseUrl?s.baseUrl+e:e},o.prototype.set_wh=function(e){this.el.style.width=e.x+"px",this.el.style.height=e.y+"px"},o.prototype.set_w_h=function(e,t){this.el.style.width=e+"px",this.el.style.height=t+"px"},t.css2dtransform&&!s.disable_css2dtransform?(o.prototype.set_xy=function(e){this.el.style[t.css2dtransform]="translate("+e.x+"px,"+e.y+"px) "},o.prototype.set_x_y=function(e,n){this.el.style[t.css2dtransform]="translate("+e+"px,"+n+"px) "}):(o.prototype.set_xy=function(e){this.el.style.left=e.x+"px",this.el.style.top=e.y+"px"},o.prototype.set_x_y=function(e,t){this.el.style.left=e+"px",this.el.style.top=t+"px"}),o.prototype.set_z=function(e){this.el.style.zIndex=Math.round(e)},o.prototype.add_img=function(e,t){var n=document.createElement("img");return n.setAttribute("class","F_sprite_img"),n.onload=function(){this.naturalWidth||(this.naturalWidth=this.width),this.naturalHeight||(this.naturalHeight=this.height),this.onload=null},n.src=o.resolve_resource(e),this.el.appendChild(n),this.img[t]=n,this.switch_img(t),n},o.prototype.adopt_img=function(e){var t=e.getAttribute("name");e.hasAttribute("class")?e.setAttribute("class",e.getAttribute("class")+" F_sprite_img"):e.setAttribute("class","F_sprite_img"),e.naturalWidth||(e.naturalWidth=e.width),e.naturalHeight||(e.naturalHeight=e.height),!e.naturalWidth&&!e.naturalHeight&&(e.onload=function(){this.naturalWidth||(this.naturalWidth=this.width),this.naturalHeight||(this.naturalHeight=this.height),this.onload=null}),this.img[t]=e,this.switch_img(t)},o.prototype.switch_img=function(e){var t,n;for(var r in this.img)if(this.img[r].style.display==""){t=this.img[r].style.left,n=this.img[r].style.top;break}for(var r in this.img)r==e?(this.img[r].style.left=t,this.img[r].style.top=n,this.img[r].style.display=""):this.img[r].style.display="none";this.cur_img=e},o.prototype.set_img_xy=function(e){this.img[this.cur_img].style.left=e.x+"px",this.img[this.cur_img].style.top=e.y+"px"},o.prototype.set_img_x_y=function(e,t){this.img[this.cur_img].style.left=e+"px",this.img[this.cur_img].style.top=t+"px"},o.prototype.remove=function(){this.el.parentNode.removeChild(this.el),this.removed=!0},o.prototype.attach=function(){this.removed&&config.canvas.appendChild(this.el)},o.prototype.hide=function(){this.el.style.display="none"},o.prototype.show=function(){this.el.style.display=""},o}),define("F.core/math",[],function(){return math={inbetween:function(e,t,n){var r,i;return t<=n?(r=t,i=n):(r=n,i=t),e>=r&&e<=i},round_d2:function(e){return Math.round(e*100)/100},negligible:function(e){return-1e-8<e&&e<1e-8},bezier2:function(e,t,n,r){var i=new Array;for(var s=0;s<r;s++)i.push(math.bezier2_step(e,t,n,s,r));return i.push(n),i},bezier2_step:function(e,t,n,r,i){function o(e,t,n,r){return((r-n)*e+n*t)/r}var s={x:0,y:0};return s.x=o(o(e.x,t.x,r,i),o(t.x,n.x,r,i),r,i),s.y=o(o(e.y,t.y,r,i),o(t.y,n.y,r,i),r,i),s},add:function(e,t){return{x:e.x+t.x,y:e.y+t.y}},sub:function(e,t){return{x:e.x-t.x,y:e.y-t.y}},sca:function(e,t){return{x:e.x*t,y:e.y*t}},length:function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},distance:function(e,t){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},negative:function(e){return{x:-e.x,y:-e.y}},normalize:function(e){return math.sca(e,1/math.length(e))},perpen:function(e){return{x:-e.y,y:e.x}},signed_area:function(e,t,n){var r=(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y);return r},intersect:function(e,t,n,r){var i,s,o,u,a;return o=(r.y-n.y)*(t.x-e.x)-(r.x-n.x)*(t.y-e.y),u=(r.x-n.x)*(e.y-n.y)-(r.y-n.y)*(e.x-n.x),a=(t.x-e.x)*(e.y-n.y)-(t.y-e.y)*(e.x-n.x),negligible(u)&&negligible(a)&&negligible(o)?{x:(e.x+t.x)*.5,y:(e.y+t.y)*.5}:negligible(o)?{x:0,y:0}:(i=u/o,s=a/o,{x:e.x+i*(t.x-e.x),y:e.y+i*(t.y-e.y)})}},math}),define("F.core/css!LF/tools/tools.css",["F.core/css-embed"],function(e){return e('table {  border:1px solid #000; } td {  border:1px solid #AAA;  width:auto; } #data {  width: 7000px; } .errorlabel {  background-color: #f00;  color: #fff;  padding: 0 5px;  border-radius: 3px; }  .Fbar {  margin:0 0 20px 0;  height:60px;  background: #7c547c;  background-image:url("http://docs.google.com/document/d/1DcPRilw9xEn8tET09rWet3o7x12rD-SkM5SoVJO1nnQ/pubimage?id=1DcPRilw9xEn8tET09rWet3o7x12rD-SkM5SoVJO1nnQ&image_id=19OMD_e2s9wHU52R1ofJIjUrpOP_KI3jKUh9n"),  linear-gradient(to right,  #7c547c 0%,#444466 50%);  background-repeat:no-repeat;  background-position:0px 0px;  background-size: contain;  color:#FFF;  text-align:right;  font-size:30px;  line-height:60px; } .Fbar a {  background-color:#FFF;  color:#7c547c;  padding:5px 10px;  border-radius:10px;  margin:0 10px; } '),!0}),define("F.core/animator",[],function(){function e(e){this.config=e,this.target=e.tar,this.I=0,this.horimirror=!1,e.borderright||(e.borderright=0),e.borderbottom||(e.borderbottom=0),e.borderleft||(e.borderleft=0),e.bordertop||(e.bordertop=0)}return e.prototype.next_frame=function(){var e=this.config;this.I++;if(!e.ani)this.I==e.gx*e.gy&&(this.I=0),this.show_frame(this.I);else{var t=e.ani[this.I];if(this.I>=e.ani.length||this.I<0)this.I=0,t=e.ani[0];this.show_frame(t)}return this.I},e.prototype.seek=function(e){var t=this.config;if(t.ani&&e>=0&&e<t.ani.length){this.I=e;var n=t.ani[this.I];this.show_frame(n)}},e.prototype.rewind=function(){this.I=-1,this.next_frame()},e.prototype.set_frame=function(e){this.I=e,this.show_frame(e)},e.prototype.hmirror=function(e){this.horimirror=e},e.prototype.show_frame=function(e){var t=this.config,n,r;n=-(e%t.gx*t.w+t.x+t.borderleft),r=-(Math.floor(e/t.gx)*t.h+t.y+t.bordertop),this.horimirror&&(n=-this.target.img[this.target.cur_img].naturalWidth-n+t.w-t.borderleft-t.borderright),this.target.set_w_h(t.w-t.borderleft-t.borderright,t.h-t.bordertop-t.borderbottom),this.target.set_img_x_y(n,r)},e.prototype.get_at=function(e){e||(e=this.I);var t=this.config;return t.graph[e%t.gx][Math.floor(e/t.gx)]},e.set=function(t,n){if(!t)return null;var r=new Object;for(var i in t){if(n&&i==n)continue;if(n&&t[n])for(var s in t[n])t[i][s]=t[n][s];r[i]=new e(t[i])}return r},e}),define("LF/sprite",["F.core/sprite","F.core/animator"],function(e,t){function n(n,r){var i=this.num_of_images=n.file.length,s=this.w=n.file[0].w+1,o=this.h=n.file[0].h+1,u=this.ani=[];this.dir="right",this.cur_img=0;var a={canvas:r,wh:{x:s,y:o},img:{}},f=this.sp=new e(a);for(var l=0;l<n.file.length;l++){var c="";for(var h in n.file[l])typeof n.file[l][h]=="string"&&h.indexOf("file")===0&&(c=n.file[l][h]);c===""&&console.log("cannot find img path in data:\n"+JSON.stringify(n.file[l])),f.add_img(c,l+"r");if(n.file[l].mirror)n.file[l].mirror!=="none"&&f.add_img(n.file[l].mirror,l+"l");else{var p=c.lastIndexOf(".");f.add_img(c.slice(0,p)+"_mirror"+c.slice(p),l+"l")}var d={x:0,y:0,w:n.file[l].w+1,h:n.file[l].h+1,gx:n.file[l].row,gy:n.file[l].col,tar:f,borderright:1,borderbottom:1};u.length++,u[l]=new t(d)}}return n.prototype.destroy=function(){this.sp.remove(),this.sp=null,this.ani.length=0},n.prototype.show_pic=function(e){var t=0;for(var n=0;n<this.ani.length;n++){var r=e-this.ani[n].config.gx*this.ani[n].config.gy;if(!(r>=0))break;e=r,t++}this.cur_img=t,this.sp.switch_img(this.cur_img+(this.dir==="right"?"r":"l")),this.ani[this.cur_img].hmirror(this.dir==="left"),this.ani[this.cur_img].set_frame(e),this.w=this.ani[this.cur_img].config.w,this.h=this.ani[this.cur_img].config.h},n.prototype.switch_lr=function(e){var t=this.ani[this.cur_img].I;this.dir=e,this.sp.switch_img(this.cur_img+(this.dir==="right"?"r":"l")),this.ani[this.cur_img].hmirror(this.dir==="left"),this.ani[this.cur_img].set_frame(t)},n.prototype.set_x_y=function(e,t){this.sp.set_x_y(e,t)},n.prototype.set_z=function(e){this.sp.set_z(e)},n.prototype.show=function(){this.sp.show()},n.prototype.hide=function(){this.sp.hide()},n}),define("LF/packages",{"LF2 1.451":{path:"LFrelease/LF2_19"}}),define("LF/global",[],function(){var e={};e.combo_list=[{name:"hit_Fa",seq:["def","left","att"]},{name:"hit_Fa",seq:["def","right","att"]},{name:"hit_Da",seq:["def","down","att"]},{name:"hit_Ua",seq:["def","up","att"]},{name:"hit_Dj",seq:["def","down","jump"]},{name:"hit_Uj",seq:["def","up","jump"]},{name:"hit_Fj",seq:["def","left","jump"]},{name:"hit_Fj",seq:["def","right","jump"]},{name:"hit_ja",seq:["def","jump","att"]}],e.lazyload=function(e){if(e.type==="character")return!0},e.gameplay={};var t=e.gameplay;return t.default={},t.default.itr={},t.default.itr.zwidth=12,t.default.cpoint={},t.default.cpoint.hurtable=0,t.default.cpoint.cover=0,t.default.cpoint.vaction=135,t.default.wpoint={},t.default.wpoint.cover=0,t.default.effect={},t.default.effect.num=0,t.default.fall={},t.default.fall.value=20,t.default.fall.dvy=-6.9,t.default.weapon={},t.default.weapon.vrest=9,t.default.character={},t.default.character.arest=7,t.default.machanics={},t.default.machanics.mass=1,t.itr={},t.itr.hit_stall=3,t.recover={},t.recover.fall=-0.7,t.recover.bdefend=-0.5,t.effect={},t.effect.num_to_id=300,t.effect.duration=3,t.character={},t.character.bounceup={},t.character.bounceup.limit={},t.character.bounceup.limit.xy=13.4,t.character.bounceup.limit.y=11,t.character.bounceup.factor={},t.character.bounceup.factor.x=.5,t.character.bounceup.factor.z=.6,t.character.bounceup.y=4.25,t.defend={},t.defend.injury={},t.defend.injury.factor=.1,t.defend.break_limit=40,t.defend.break_absorb={5:0,15:5},t.fall={},t.fall.KO=60,t.friction={},t.friction.fell={3:2,5:3,6:4,9:5,15:7},t.min_speed=1,t.gravity=1.7,t.weapon={},t.weapon.bounceup={},t.weapon.bounceup.limit=8,t.weapon.bounceup.speed={},t.weapon.bounceup.speed.y=-3.7,t.weapon.bounceup.factor={},t.weapon.bounceup.factor.x=.6,t.weapon.bounceup.factor.z=.6,t.weapon.soft_bounceup={},t.weapon.soft_bounceup.speed={},t.weapon.soft_bounceup.speed.y=-2,t.weapon.hit={},t.weapon.hit.vx=-3,t.weapon.hit.vy=0,t.weapon.gain={},t.weapon.gain.factor={},t.weapon.gain.factor.x=1.1,t.weapon.gain.factor.y=1.8,t.weapon.reverse={},t.weapon.reverse.factor={},t.weapon.reverse.factor.vx=-0.4,t.weapon.reverse.factor.vy=-2,t.weapon.reverse.factor.vz=-0.4,t.unspecified=-842150451,e}),define("LF/loader",["LF/packages","LF/global"],function(e,t){return{load:function(n,r,i,s){function h(e){o=p(e.path),u.location=p(s.baseUrl)+o,r([o+"manifest"],function(e){var t={data:"string",properties:"string",resourcemap:"string!optional"};y(t,e)||console.log("loader: error: manifest.js of "+o+" is not correct."),r([o+e.data],d),a=e,v("properties"),v("resourcemap")})}function p(e){return e===""?e:(e=e.replace(/\\/g,"/"),e.charAt(e.length-1)!=="/"&&(e+="/"),e.charAt(0)==="/"&&(e=e.slice(1)),e)}function d(e){function n(e){if(typeof t.lazyload!="function")return!0;if(!t.lazyload(e))return!0}var i=[];for(var s=0;s<e.object.length;s++)n(e.object[s])&&i.push(o+e.object[s].file);r(i,function(){var t={};for(var r in e)r==="object"?t[r]=[]:t[r]=e[r];for(var r=0,i=0;r<e.object.length;r++){var s=e.object[r],a={id:s.id,type:s.type};n(s)?(a.data=arguments[i],i++):(a.data="lazy",a.file=o+s.file),t.object.push(a)}u.data=t,g(),m()})}function v(e){r([o+a[e]],function(t){u[e]=t,m()})}function m(){var e={data:"object",properties:"object",resourcemap:"object!optional",location:"string"};y(e,u)&&i(u)}function g(){typeof t.lazyload=="function"&&(u.data.object.load=function(e,t){var n=u.data.object,r=[],i=[];for(var s=0;s<e.length;s++){var o;for(var a=0;a<n.length;a++)if(n[a].id===e[s]){o=n[a];break}o&&o.data==="lazy"&&(r.push(o),i.push(o.file))}requirejs(i,function(){for(var e=0;e<arguments.length;e++)r[e].data=arguments[e];t()})})}function y(e,t){var n=!1;if(t){n=!0;for(var r in e){var i=e[r].split("!"),s=i[0],o=i[1]||"";if(typeof t[r]!==s)if(typeof t[r]!="undefined"||!o||o!=="optional"){n=!1;break}}}return n}var o="",u={},a={};if(s.isBuild){i();return}var f,l=0;for(var c in e)l===0&&(f=c),l++;l===1&&h(e[f])},normalize:function(e,t){return e}}}),define("F.core/controller",[],function(){function e(e){return n.key(e,1)}function t(e){return n.key(e,0)}function r(e){this.state={},this.config=e,this.keycode={},this.child=new Array,this.sync=!1,this.buf=new Array,n.child.push(this),this.clear_states();for(var t in this.config)this.keycode[t]=r.keyname_to_keycode(this.config[t])}var n=function(){document.addEventListener?(document.addEventListener("keydown",e,!0),document.addEventListener("keyup",t,!0)):document.attachEvent&&(document.attachEvent("keydown",e),document.attachEvent("keyup",t));var n=new Object;return n.child=[],n.key=function(e,t){e||(e=window.event);for(var n in this.child)if(this.child[n].key(e.keyCode,t))break},n}();return r.prototype.key=function(e,t){var n=0;for(var r in this.config)if(this.keycode[r]==e){if(this.sync===!1){if(this.child)for(var i in this.child)this.child[i].key(r,t);this.state[r]=t}else this.buf.push([r,t]);n=1;break}return n},r.prototype.clear_states=function(){for(var e in this.config)this.state[e]=0},r.prototype.fetch=function(){for(var e in this.buf){var t=this.buf[e][0],n=this.buf[e][1];if(this.child)for(var r in this.child)this.child[r].key(t,n);this.state[t]=n}this.buf=[]},r.prototype.flush=function(){this.buf=[]},r.keyname_to_keycode=r.prototype.keyname_to_keycode=function(e){var t;if(e.length==1){var n=e.charCodeAt(0);if(n>="a".charCodeAt(0)&&n<="z".charCodeAt(0)||n>="A".charCodeAt(0)&&n<="Z".charCodeAt(0))e=e.toUpperCase(),t=e.charCodeAt(0);else if(n>="0".charCodeAt(0)&&n<="9".charCodeAt(0))t=e.charCodeAt(0);else switch(e){case"`":t=192;break;case"-":t=189;break;case"=":t=187;break;case"[":t=219;break;case"]":t=221;break;case"\\":t=220;break;case";":t=186;break;case"'":t=222;break;case",":t=188;break;case".":t=190;break;case"/":t=191;break;case" ":t=32}}else switch(e){case"ctrl":t=17;break;case"up":t=38;break;case"down":t=40;break;case"left":t=37;break;case"right":t=39;break;case"space":t=32}return t},r.keycode_to_keyname=r.prototype.keycode_to_keyname=function(e){if(e>="A".charCodeAt(0)&&e<="Z".charCodeAt(0)||e>="0".charCodeAt(0)&&e<="9".charCodeAt(0))return String.fromCharCode(e).toLowerCase();var t=e;switch(e){case 38:t="up";break;case 40:t="down";break;case 37:t="left";break;case 39:t="right";break;case 32:t="space"}return t},r}),define("LF/mechanics",["LF/global"],function(e){function n(t){var n=t.spec;n[t.id]&&n[t.id].mass?this.mass=n[t.id].mass:this.mass=e.gameplay.default.machanics.mass,this.ps,this.sp=t.sp,this.frame=t.frame,this.parent=t,this.vol_body={0:{},1:{},2:{},3:{},4:{},5:{},length:0,empty_data:{}}}var t=e.gameplay;return n.prototype.body=function(e,t,n){var r=this.ps,i=this.sp,s=n;e||(e=this.frame.D.bdy);if(e===this.frame.D.bdy&&!t)return this.body_body(n);if(e instanceof Array){if(!t&&e.length===2)return[this.volume(e[0],s),this.volume(e[1],s)];if(!t&&e.length===3)return[this.volume(e[0],s),this.volume(e[1],s),this.volume(e[2],s)];var o=[];for(var u in e)(!t||t(e[u]))&&o.push(this.volume(e[u],s));return o}return!t||t(e)?[this.volume(e,s)]:[]},n.prototype.body_body=function(e){var n=this.frame.D.bdy,r=this.ps,i=this.sp;if(!n){var s=this.vol_body[0];e?(s.x=e.x,s.y=e.y,s.z=e.z):(s.x=r.sx,s.y=r.sy,s.z=r.sz),s.vx=0,s.vy=0,s.w=0,s.h=0,s.zwidth=0,s.data=this.vol_body.empty_data,this.vol_body.length=1}else if(n instanceof Array){for(var o=0;o<n.length;o++){var s=this.vol_body[o],u=n[o].x;r.dir==="left"&&(u=i.w-n[o].x-n[o].w),e?(s.x=r.sx+e.x,s.y=r.sy+e.y,s.z=r.sz+e.z):(s.x=r.sx,s.y=r.sy,s.z=r.sz),s.vx=u,s.vy=n[o].y,s.w=n[o].w,s.h=n[o].h,s.zwidth=n[o].zwidth?n[o].zwidth:t.default.itr.zwidth,s.data=n[o]}this.vol_body.length=n.length}else{var s=this.vol_body[0],u=n.x;r.dir==="left"&&(u=i.w-n.x-n.w),e?(s.x=r.sx+e.x,s.y=r.sy+e.y,s.z=r.sz+e.z):(s.x=r.sx,s.y=r.sy,s.z=r.sz),s.vx=u,s.vy=n.y,s.w=n.w,s.h=n.h,s.zwidth=n.zwidth?n.zwidth:t.default.itr.zwidth,s.data=n,this.vol_body.length=1}return this.vol_body},n.prototype.volume=function(e,n){var r=this.ps,i=this.sp;if(!e)return n?{x:n.x,y:n.y,z:n.z,vx:0,vy:0,w:0,h:0,zwidth:0,data:{}}:{x:r.sx,y:r.sy,z:r.sz,vx:0,vy:0,w:0,h:0,zwidth:0,data:{}};var s=e.x;return r.dir==="left"&&(s=i.w-e.x-e.w),n?{x:r.sx+n.x,y:r.sy+n.y,z:r.sz+n.z,vx:s,vy:e.y,w:e.w,h:e.h,zwidth:e.zwidth?e.zwidth:t.default.itr.zwidth,data:e}:{x:r.sx,y:r.sy,z:r.sz,vx:s,vy:e.y,w:e.w,h:e.h,zwidth:e.zwidth?e.zwidth:t.default.itr.zwidth,data:e}},n.prototype.make_point=function(e){var t=this.ps,n=this.sp;return e?t.dir==="right"?{x:t.sx+e.x,y:t.sy+e.y,z:t.sz+e.y}:{x:t.sx+n.w-e.x,y:t.sy+e.y,z:t.sz+e.y}:(console.log("mechanics: make point failed"),{x:t.sx,y:t.sy,z:t.sz})},n.prototype.coincideXZ=function(e,t){var n=this.ps,r=this.sp,i=this.frame.D,s=e.x-t.x,o=e.z-t.z;n.x+=s,n.z+=o,n.sx=n.dir==="right"?n.x-i.centerx:n.x+i.centerx-r.w},n.prototype.coincideXY=function(e,t){var n=this.ps,r=this.sp,i=this.frame.D,s=e.x-t.x,o=e.y-t.y;n.x+=s,n.y+=o,n.sx=n.dir==="right"?n.x-i.centerx:n.x+i.centerx-r.w,n.sy=n.y-i.centery},n.prototype.create_metric=function(){return this.ps={sx:0,sy:0,sz:0,x:0,y:0,z:0,vx:0,vy:0,vz:0,zz:0,dir:"right",fric:1},this.ps},n.prototype.reset=function(){var e=this.ps;e.sx=0,e.sy=0,e.sz=0,e.x=0,e.y=0,e.z=0,e.vx=0,e.vy=0,e.vz=0,e.zz=0,e.dir="right",e.fric=1},n.prototype.set_pos=function(e,t,n){var r=this.ps,i=this.sp,s=this.frame.D;r.x=e,r.y=t,r.z=n,r.sx=r.dir==="right"?r.x-s.centerx:r.x+s.centerx-i.w,r.sy=t-s.centery,r.sz=n},n.prototype.dynamics=function(){var t=this.ps,n=this.sp,r=this.frame.D,i=e.gameplay;this.blocking_xz()||(t.x+=t.vx,t.z+=t.vz),t.y+=t.vy,t.sx=t.dir==="right"?t.x-r.centerx:t.x+r.centerx-n.w,t.sy=t.y-r.centery,t.sz=t.z,t.y>0&&(t.y=0,t.sy=t.y-r.centery),n.set_x_y(t.sx,t.sy+t.sz),n.set_z(t.sz+t.zz),t.y===0&&(t.vx&&(t.vx+=(t.vx>0?-1:1)*t.fric),t.vz&&(t.vz+=(t.vz>0?-1:1)*t.fric),t.vx!==0&&t.vx>-i.min_speed&&t.vx<i.min_speed&&(t.vx=0),t.vz!==0&&t.vz>-i.min_speed&&t.vz<i.min_speed&&(t.vz=0)),t.y<0&&(t.vy+=this.mass*i.gravity)},n.prototype.unit_friction=function(){var e=this.ps;e.y===0&&(e.vx&&(e.vx+=e.vx>0?-1:1),e.vz&&(e.vz+=e.vz>0?-1:1))},n.prototype.linear_friction=function(e,t){var n=this.ps;e&&n.vx&&(n.vx+=n.vx>0?-e:e),t&&n.vz&&(n.vz+=n.vz>0?-t:t)},n.prototype.blocking_xz=function(){var e={x:this.ps.vx,y:0,z:this.ps.vz},t=this.body(null,null,e);for(var n=0;n<t.length;n++){t[n].zwidth=0;var r=this.parent.scene.query(t[n],this.parent,{tag:"itr:14"});if(r.length>0)return!0}},n.prototype.project=function(){var e=this.ps,t=this.sp;t.set_x_y(e.sx,e.sy+e.sz),t.set_z(e.sz+e.zz)},n.prototype.speed=function(){var e=this.ps;return Math.sqrt(e.vx*e.vx+e.vy*e.vy)},n}),define("F.core/combodec",[],function(){function e(e,t,n){this.time=1,this.timeout=0,this.comboout=0,this.con=e,this.seq=new Array,this.config=t,this.combo=n,this.con.child.push(this)}return e.prototype.key=function(e,t){if(!t)return;var n=this.seq,r=!0;if(this.config.rp)for(var i=n.length-1,s=1;i>=0&&n[i]==e;i--,s++)s>=this.config.rp[e]&&(r=!1);this.con.state[e]&&(r=!1),this.config.timeout&&(this.timeout=this.time+this.config.timeout),this.config.comboout&&(this.comboout=this.time+this.config.comboout),r&&n.push({k:e,t:this.time});if(this.combo&&r){var o=this.combo;for(var i in o){var u=!0,a=n.length-o[i].seq.length;if(a<0)u=!1;else for(var f=0;a<n.length;a++,f++)if(o[i].seq[f]!==n[a].k||o[i].maxtime&&n[n.length-1].t-n[a].t>o[i].maxtime){u=!1;break}u&&(this.config.callback(o[i]),(o[i].clear_on_combo||o[i].clear_on_combo!==!1&&this.config.clear_on_combo)&&this.clear_seq())}}},e.prototype.clear_seq=function(){this.seq.length=0,this.timeout=this.time-1,this.comboout=this.time-1},e.prototype.frame=function(){this.time===this.timeout&&this.clear_seq(),this.time===this.comboout&&this.seq.push({k:"_",t:this.time}),this.time++},e}),define("LF/livingobject",["LF/global","LF/sprite","LF/mechanics","F.core/combodec"],function(e,t,n,r){function s(i,s,u){if(!i)return;var a=this;a.type="livingobject",a.name=s.bmp.name,a.uid=-1,a.id=u,a.data=s,a.spec=i.spec,a.team=i.team,a.states=null,a.statemem={},a.states_switch_dir=null,a.match=i.match,a.scene=i.scene,a.visualeffect=i.effects,a.sp=new t(s.bmp,i.stage),a.health={hp:100,mp:100,bdefend:0,fall:0},a.frame={PN:0,N:0,D:s.frame[0],ani:{i:0,up:!0}},a.mech=new n(a),a.ps=a.mech.create_metric(),a.trans=new o(a),a.itr={vrest:[],lasthit:-100},a.effect={i:0,dvx:0,dvy:0,oscillate:0,stuck:!1,timein:0,timeout:0},a.catching=0,a.hold={obj:null,id:0},a.switch_dir=!0,a.con=i.controller;if(a.con){function f(e){var t=e.name;switch(t){case"left":case"right":a.switch_dir&&a.switch_dir_fun(t)}a.statemem.combo=t}var l={clear_on_combo:!0,callback:f},c=[{name:"left",seq:["left"],clear_on_combo:!1},{name:"right",seq:["right"],clear_on_combo:!1},{name:"up",seq:["up"],clear_on_combo:!1},{name:"down",seq:["down"],clear_on_combo:!1},{name:"def",seq:["def"],clear_on_combo:!1},{name:"jump",seq:["jump"],clear_on_combo:!1},{name:"att",seq:["att"],clear_on_combo:!1},{name:"run",seq:["right","right"],maxtime:9},{name:"run",seq:["left","left"],maxtime:9}];a.combodec=new r(a.con,l,c.concat(e.combo_list))}}function o(e){var t=1,n=999,r=0,i=1;this.frame=function(e,t){this.set_next(e,t),this.set_wait(0,t)},this.set_wait=function(e,n,s){n||(n=0),n===99&&(n=r),s||(s=1),n>=r&&(r=n,i=s,s===99&&(i=t),t=e,t<0&&(t=0))},this.inc_wait=function(e,n,s){n||(n=0),n===99&&(n=r),s||(s=1),n>=r&&(r=n,i=s,s===99&&(i=t),t+=e,t<0&&(t=0))},this.next=function(){return n},this.wait=function(){return t},this.set_next=function(e,s,o){s||(s=0),s===99&&(s=r),o||(o=1),s>=r&&(r=s,i=o,o===99&&(i=t),n=e)},this.reset_lock=function(e){e||(e=0),e===99&&(e=r),e>=r&&(r=0)},this.next_frame_D=function(){var t=n;return t===999&&(t=0),e.data.frame[t]},this.trans=function(){var s=r;i--,i===0&&(r=0);if(t===0){if(n!==0){n===999&&(n=0),e.frame.PN=e.frame.N,e.frame.N=n,e.state_update("frame_exit");var o=e.frame.D.state!==e.data.frame[n].state;o&&e.state_update("state_exit"),e.frame.D=e.data.frame[n];if(o){e.statemem={};var u=e.switch_dir;e.states_switch_dir&&e.states_switch_dir[e.frame.D.state]!==undefined?e.switch_dir=e.states_switch_dir[e.frame.D.state]:e.switch_dir=!1,e.state_update("state_entry"),e.switch_dir&&!u&&e.con&&(e.con.state.left&&e.switch_dir_fun("left"),e.con.state.right&&e.switch_dir_fun("right"))}e.frame_update(),s===10&&t>0&&(t-=1)}}else t--}}var i=e.gameplay;return s.prototype.destroy=function(){this.sp.destroy()},s.prototype.combo_update=function(){var e=this,t=e.statemem.combo;t||(t=null);var n=e.states[e.frame.D.state];if(n)var r=n.call(e,"combo",t);var i=e.states.generic;if(!r&&i)var s=i.call(e,"combo",t);n&&n.call(e,"post_combo"),i&&i.call(e,"post_combo");if(r||s||t==="left"||t==="right"||t==="up"||t==="down")e.statemem.combo=null},s.prototype.setup=function(){var e=this;e.state_update("setup"),e.scene.add(e)},s.prototype.frame_update=function(){var e=this;e.sp.show_pic(e.frame.D.pic),e.ps.fric=1;if(e.frame.D.dvx){var t=e.ps.vx>0?e.ps.vx:-e.ps.vx;if(e.ps.y<0||t<e.frame.D.dvx)e.ps.vx=e.dirh()*e.frame.D.dvx}e.frame.D.dvz&&(e.ps.vz=e.dirv()*e.frame.D.dvz),e.frame.D.dvy&&(e.ps.vy=e.frame.D.dvy),e.trans.set_wait(e.frame.D.wait,99),e.trans.set_next(e.frame.D.next,99),e.state_update("frame")},s.prototype.TU_update=function(){var e=this;e.effect.stuck||e.state_update("TU"),e.effect.timein<0&&(e.effect.oscillate&&(e.effect.i===1?e.effect.i=-1:e.effect.i=1,e.sp.set_x_y(e.ps.sx+e.effect.oscillate*e.effect.i,e.ps.sy+e.ps.sz)),e.effect.timeout===0?(e.effect.oscillate=0,e.effect.stuck=!1,e.sp.set_x_y(e.ps.sx,e.ps.sy+e.ps.sz)):e.effect.timeout===-1&&(e.effect.dvx&&(e.ps.vx=e.effect.dvx),e.effect.dvy&&(e.ps.vy=e.effect.dvy),e.effect.dvx=0,e.effect.dvy=0),e.effect.timeout--),e.itr.lasthit--,e.itr.lasthit<-3&&(e.health.fall>0&&(e.health.fall+=i.recover.fall),e.health.bdefend>0&&(e.health.bdefend+=i.recover.bdefend));for(var t in e.itr.vrest)e.itr.vrest[t]>0&&e.itr.vrest[t]--;e.itr.arest>0&&e.itr.arest--},s.prototype.state_update=function(e){var t=this,n=t.states.generic;if(n)var r=n.call(t,e);var i=t.states[t.frame.D.state];if(i)var s=i.call(t,e);if(n)var o=n.call(t,"post_"+e);return r||s||o},s.prototype.TU=function(){var e=this;e.TU_update(),e.con&&e.combodec.frame()},s.prototype.transit=function(){var e=this;e.con&&(e.con.fetch(),e.combo_update()),e.effect.timein<0&&e.effect.stuck||e.trans.trans(),e.effect.timein--},s.prototype.set_pos=function(e,t,n){this.mech.set_pos(e,t,n)},s.prototype.vol_body=function(){return this.mech.body_body()},s.prototype.cur_state=function(){return this.frame.D.state},s.prototype.effect_id=function(e){return e+i.effect.num_to_id},s.prototype.effect_create=function(e,t){var n=this;if(e!==null&&e!==undefined){var r=e+i.effect.num_to_id;n.proper(r,"oscillate")&&(n.effect.oscillate=n.proper(r,"oscillate")),n.proper(r,"cant_move")&&(n.effect.stuck=!0)}n.effect.timein=0,n.effect.timeout=t},s.prototype.effect_stuck=function(e){var t=this;t.effect.stuck=!0,t.effect.timein=0,t.effect.timeout=e},s.prototype.visualeffect_create=function(e,t,n,r){var s=this,o=e+i.effect.num_to_id,u={x:t.x+t.vx+(n?t.w:0),y:t.y+t.vy+t.h/2,z:t.z>s.ps.z?t.z:s.ps.z};s.visualeffect.create(u,o,r)},s.prototype.frame_ani_oscillate=function(e,t){var n=this,r=n.frame;if(r.ani.i<e||r.ani.i>t)r.ani.up=!0,r.ani.i=e+1;r.ani.i<t&&r.ani.up?n.trans.set_next(r.ani.i++):r.ani.i>e&&!r.ani.up&&n.trans.set_next(r.ani.i--),r.ani.i==t&&(r.ani.up=!1),r.ani.i==e&&(r.ani.up=!0)},s.prototype.frame_ani_sequence=function(e,t){var n=this,r=n.frame;if(r.ani.i<e||r.ani.i>t)r.ani.i=e+1;trans.set_next(r.ani.i++),r.ani.i>t&&(r.ani.i=e)},s.prototype.itr_rest_update=function(e,t){var n=this,r;t.arest?r=t.arest:t.vrest?r=t.vrest:r=i.default.character.arest,n.itr.vrest[e]=r},s.prototype.itr_rest_test=function(e,t){var n=this;if(!n.itr.vrest[e])return!0},s.prototype.switch_dir_fun=function(e){var t=this;t.ps.dir==="left"&&e==="right"?(t.ps.dir="right",t.sp.switch_lr("right")):t.ps.dir==="right"&&e==="left"&&(t.ps.dir="left",t.sp.switch_lr("left"))},s.prototype.dirh=function(){var e=this;return e.ps.dir==="left"?-1:1},s.prototype.dirv=function(){var e=this,t=0;return e.con&&(e.con.state.up&&(t-=1),e.con.state.down&&(t+=1)),t},s.prototype.proper=function(e,t){var n=this;return arguments.length===1&&(t=e,e=n.id),n.spec[e]?n.spec[e][t]:null},s}),define("LF/util",[],function(){var e={};return e.select_from=function(e,t,n){for(var r in e){var i=e[r],s=!0;for(var o in t)i[o]!==t[o]&&(s=!1);if(s)return i}},e.lookup=function(e,t){for(var n in e)if(t<=n)return e[n]},e.setup_resourcemap=function(e,t){var n=!1;if(e.resourcemap&&typeof e.resourcemap.condition=="string"){var r=e.resourcemap.condition.split(" ");r[0]==="location"&&r[1]==="contain"&&r[2]&&r[3]==="at"&&r[4]?(r[4]=parseInt(r[4]),e.resourcemap.condition=function(){return window.location.href.indexOf(r[2])===r[4]}):r[0]==="location"&&r[1]==="contain"&&r[2]&&(e.resourcemap.condition=function(){return window.location.href.indexOf(r[2])!==-1});if(typeof e.resourcemap.condition=="function"){var i=[e.resourcemap,{get:function(t){return e.location+t}}];t.masterconfig_set("resourcemap",i),n=!0}}n||t.masterconfig_set("baseUrl",e.location)},e}),define("LF/character",["LF/livingobject","LF/global","F.core/util","LF/util"],function(e,t,n,r){function u(t,n,r){var i=this;e.call(this,t,n,r),i.type="character",i.states=s,i.states_switch_dir=o,i.setup()}var i=t.gameplay,s={generic:function(e,t){var n=this;switch(e){case"TU":n.post_interaction(),n.mech.dynamics(),n.wpoint.call(n);var s=n.ps;if(s.y===0&&s.vy>0){var o=n.state_update("fell_onto_ground");o?n.trans.frame(o,15):(s.vy=0,n.mech.linear_friction(r.lookup(i.friction.fell,s.vx),r.lookup(i.friction.fell,s.vz)))}else if(s.y+s.vy>=0&&s.vy>0){var o=n.state_update("fall_onto_ground");o?n.trans.frame(o,15):n.frame.N===212?n.trans.frame(215,15):n.trans.frame(219,15)}else s.y===0&&n.frame.N===212;break;case"combo":switch(t){case"left":case"right":case"run":break;default:t==="def"&&(t="hit_d"),t==="jump"&&(t="hit_j"),t==="att"&&(t="hit_a");if(n.frame.D[t])return n.trans.frame(n.frame.D[t],11),1}break;case"post_combo":n.pre_interaction()}},0:function(e,t){var r=this;switch(e){case"frame":r.hold.obj&&r.hold.obj.type==="heavyweapon"&&r.trans.frame(12);break;case"combo":switch(t){case"left":case"right":case"up":case"down":case"jump":var i=r.con.state.left!==r.con.state.right,s=r.con.state.up!==r.con.state.down;if(i||s)t!=="jump"&&r.trans.frame(5),r.hold.obj&&r.hold.obj.type==="heavyweapon"?(i&&(r.ps.vx=r.dirh()*r.data.bmp.heavy_walking_speed),r.ps.vz=r.dirv()*r.data.bmp.heavy_walking_speedz):(i&&(r.ps.vx=r.dirh()*r.data.bmp.walking_speed),r.ps.vz=r.dirv()*r.data.bmp.walking_speedz)}switch(t){case"run":return r.hold.obj&&r.hold.obj.type==="heavyweapon"?r.trans.frame(16,10):r.trans.frame(9,10),1;case"def":if(r.hold.obj&&r.hold.obj.type==="heavyweapon")return 1;return r.trans.frame(110,10),1;case"jump":if(r.hold.obj&&r.hold.obj.type==="heavyweapon")return r.proper("heavy_weapon_jump")?(r.trans.frame(r.proper("heavy_weapon_jump"),10),1):1;return r.trans.frame(210,10),1;case"att":if(r.hold.obj){var i=r.con.state.left!==r.con.state.right;if(r.hold.obj.type==="heavyweapon")return r.trans.frame(50,10),1;if(r.proper(r.hold.id,"just_throw"))return r.trans.frame(45,10),1;if(i&&r.proper(r.hold.id,"stand_throw"))return r.trans.frame(45,10),1;if(r.proper(r.hold.id,"attackable"))return r.trans.frame(r.match.random()<.5?20:25,10),1}var o=r.mech.volume(n.make_array(r.data.frame[72].itr)[0]),u=r.scene.query(o,r,{tag:"itr:6",not_team:r.team});for(var a in u){var f=u[a].vol_itr(6)[0].data;if(r.itr_rest_test(u[a].uid,f))return r.trans.frame(70,10),r.itr_rest_update(u[a].uid,f),1}return r.trans.frame(r.match.random()<.5?60:65,10),1}}},1:function(e,t){var n=this,r=n.con.state.left!==n.con.state.right,i=n.con.state.up!==n.con.state.down;switch(e){case"frame":n.hold.obj&&n.hold.obj.type==="heavyweapon"?r||i?n.frame_ani_oscillate(12,15):n.trans.set_next(n.frame.N):n.frame_ani_oscillate(5,8),n.trans.set_wait(n.data.bmp.walking_frame_rate-1);break;case"TU":n.hold.obj&&n.hold.obj.type==="heavyweapon"?(r&&(n.ps.vx=n.dirh()*n.data.bmp.heavy_walking_speed),n.ps.vz=n.dirv()*n.data.bmp.heavy_walking_speedz):(r&&(n.ps.vx=n.dirh()*n.data.bmp.walking_speed),n.ps.vz=n.dirv()*n.data.bmp.walking_speedz),!r&&!i&&!n.statemem.transed&&(n.statemem.transed=!0,n.trans.set_next(999),n.trans.set_wait(1,1,2));break;case"state_entry":n.trans.set_wait(0);break;case"combo":!r&&!i&&!n.statemem.released&&(n.statemem.released=!0,n.mech.unit_friction());if(t)return n.states[0].call(n,e,t)}},2:function(e,t){var n=this;switch(e){case"frame":n.hold.obj&&n.hold.obj.type==="heavyweapon"?n.frame_ani_oscillate(16,18):n.frame_ani_oscillate(9,11),n.trans.set_wait(n.data.bmp.running_frame_rate);case"TU":n.hold.obj&&n.hold.obj.type==="heavyweapon"?(n.ps.vx=n.dirh()*n.data.bmp.heavy_running_speed,n.ps.vz=n.dirv()*n.data.bmp.heavy_running_speedz):(n.ps.vx=n.dirh()*n.data.bmp.running_speed,n.ps.vz=n.dirv()*n.data.bmp.running_speedz);break;case"combo":switch(t){case"left":case"right":if(t!=n.ps.dir)return n.hold.obj&&n.hold.obj.type==="heavyweapon"?n.trans.frame(19,10):n.trans.frame(218,10),!0;break;case"def":if(n.hold.obj&&n.hold.obj.type==="heavyweapon")return 1;return n.trans.frame(102,10),!0;case"jump":if(n.hold.obj&&n.hold.obj.type==="heavyweapon")return n.proper("heavy_weapon_dash")?(n.trans.frame(n.proper("heavy_weapon_dash"),10),1):1;return n.trans.frame(213,10),!0;case"att":if(n.hold.obj){if(n.hold.obj.type==="heavyweapon")return n.trans.frame(50,10),1;var r=n.con.state.left!==n.con.state.right;if(r&&n.proper(n.hold.id,"run_throw"))return n.trans.frame(45,10),1;if(n.proper(n.hold.id,"attackable"))return n.trans.frame(35,10),1}return n.trans.frame(85,10),1}}},3:function(e,t){var n=this;switch(e){case"frame":n.frame.D.next===999&&n.ps.y<0&&n.trans.set_next(212);switch(n.frame.N){case 85:case 86:n.ps.fric=.6;break;case 60:case 65:n.ps.fric=0;break;case 71:n.ps.fric=.3}}},4:function(e,t){var n=this;switch(e){case"frame":n.statemem.frameTU=!0;break;case"TU":if(n.statemem.frameTU){n.statemem.frameTU=!1;if(n.frame.N===212&&n.frame.PN===211){var r=0;n.con.state.left&&(r-=1),n.con.state.right&&(r+=1),n.ps.vx=r*(n.data.bmp.jump_distance-1),n.ps.vz=n.dirv()*(n.data.bmp.jump_distancez-1),n.ps.vy=n.data.bmp.jump_height}}break;case"combo":if(t==="att"&&n.frame.N===212){if(n.hold.obj){var r=n.con.state.left!==n.con.state.right;r&&n.proper(n.hold.id,"jump_throw")?n.trans.frame(52,10):n.proper(n.hold.id,"attackable")&&n.trans.frame(30,10)}else n.trans.frame(80,10);return 1}}},5:function(e,t){var n=this;switch(e){case"state_entry":n.ps.vx=n.dirh()*(n.data.bmp.dash_distance-1),n.ps.vz=n.dirv()*(n.data.bmp.dash_distancez-1),n.ps.vy=n.data.bmp.dash_height;break;case"combo":if(t==="att")if(n.proper("dash_backattack")||n.dirh()===(n.ps.vx>0?1:-1))return n.hold.obj&&n.proper(n.hold.id,"attackable")?n.trans.frame(40,10):n.trans.frame(90,10),n.switch_dir=!1,1;if(t==="left"||t==="right")if(t!=n.ps.dir)return n.dirh()==(n.ps.vx>0?1:-1)?(n.frame.N===213&&n.trans.frame(214,0),n.frame.N===216&&n.trans.frame(217,0)):(n.frame.N===214&&n.trans.frame(213,0),n.frame.N===217&&n.trans.frame(216,0)),1}},6:function(e,t){var n=this;switch(e){case"TU":n.ps.vx=n.dirh()*n.frame.D.dvx,n.ps.vz=n.dirv()*n.frame.D.dvz}},7:function(e,t){var n=this;switch(e){case"frame":n.frame.N===111&&n.trans.inc_wait(4)}},8:function(e,t){var n=this;switch(e){case"frame":switch(n.frame.N){case 114:n.ps.fric=0}}},9:function(e,t){var n=this;switch(e){case"state_entry":n.statemem.stateTU=!0,n.statemem.counter=43,n.statemem.attacks=0;break;case"state_exit":n.catching=null,n.ps.zz=0;break;case"frame":switch(n.frame.N){case 123:n.statemem.attacks++,n.statemem.counter+=3,n.trans.inc_wait(1);break;case 233:case 234:n.trans.inc_wait(-1)}if(n.frame.N===234)return;n.catching.caught_b(n.mech.make_point(n.frame.D.cpoint),n.frame.D.cpoint,n.ps.dir);break;case"TU":if(n.caught_cpointkind()===1&&n.catching.caught_cpointkind()===2&&n.statemem.stateTU){n.statemem.stateTU=!1,n.frame.D.cpoint.injury&&(n.catching.hit(n.frame.D.cpoint,n,{x:n.ps.x,y:n.ps.y,z:n.ps.z},null),n.trans.inc_wait(1,10,99));var r=i.default.cpoint.cover;n.frame.D.cpoint.cover!==undefined&&(r=n.frame.D.cpoint.cover),r===0||r===10?n.ps.zz=1:n.ps.zz=-1,n.frame.D.cpoint.dircontrol===1&&(n.con.state.left&&n.switch_dir_fun("left"),n.con.state.right&&n.switch_dir_fun("right"))}break;case"post_combo":n.statemem.counter--,n.statemem.counter<=0&&(n.frame.N!==122||n.statemem.attacks!==4)&&(n.frame.N===121||n.frame.N===122)&&(n.catching.caught_release(),n.trans.frame(999,15));break;case"combo":switch(t){case"att":if(n.frame.N===121){var s=n.con.state.left!==n.con.state.right,o=n.con.state.up!==n.con.state.down;if((s||o)&&n.frame.D.cpoint.taction){var u=n.frame.D.cpoint.taction;u<0?(n.switch_dir_fun(n.ps.dir==="right"?"left":"right"),n.trans.frame(-u,10)):n.trans.frame(u,10);var a=n.data.frame[n.trans.next()];n.catching.caught_throw(a.cpoint,n.dirv()),n.statemem.counter+=10}else n.frame.D.cpoint.aaction?n.trans.frame(n.frame.D.cpoint.aaction,10):n.trans.frame(122,10)}return 1;case"jump":if(n.frame.N===121&&n.frame.D.cpoint.jaction)return n.trans.frame(n.frame.D.cpoint.jaction,10),1}}},10:function(e,t){var n=this;switch(e){case"state_exit":n.catching=null,n.caught_b_holdpoint=null,n.caught_b_cpoint=null,n.caught_b_adir=null,n.caught_throwz=null;break;case"frame":n.statemem.frameTU=!0,n.trans.set_wait(99,10,99);break;case"TU":n.frame.N===135&&(n.ps.vy=0);if(n.caught_cpointkind()===2&&n.catching&&n.catching.caught_cpointkind()===1){if(n.statemem.frameTU){n.statemem.frameTU=!1;var r=n.caught_b_holdpoint,s=n.caught_b_cpoint,o=n.caught_b_adir;s.vaction&&n.trans.frame(s.vaction,20);if(s.throwvz!==i.unspecified){var u=s.throwvx,a=s.throwvy,f=s.throwvz;u!==0&&(n.ps.vx=(o==="right"?1:-1)*u),a!==0&&(n.ps.vy=a),f!==0&&(n.ps.vz=f*n.caught_throwz),n.mech.set_pos(n.ps.x+n.ps.vx*2.5,n.ps.y+n.ps.vy*2,n.ps.z+n.ps.vz)}else s.dircontrol===undefined?(s.cover&&s.cover>=10?n.switch_dir_fun(o):n.switch_dir_fun(o==="left"?"right":"left"),n.mech.coincideXZ(r,n.mech.make_point(n.frame.D.cpoint))):n.mech.coincideXY(r,n.mech.make_point(n.frame.D.cpoint))}}else n.catching&&n.trans.frame(212,10)}},11:function(e,t){var n=this;switch(e){case"state_entry":n.trans.inc_wait(0,20);break;case"frame":switch(n.frame.N){case 221:case 223:case 225:n.trans.set_next(999);break;case 220:case 222:case 224:case 226:}}},12:function(e,t){var n=this;switch(e){case"frame":if(n.effect.dvy<=0)switch(n.frame.N){case 180:n.trans.set_next(181),n.trans.set_wait(1);break;case 181:n.trans.set_next(182);var r=n.ps.vy>0?n.ps.vy:-n.ps.vy;0<=r&&r<=4?n.trans.set_wait(2):4<r&&r<7?n.trans.set_wait(3):7<=r&&n.trans.set_wait(4);break;case 182:n.trans.set_next(183);break;case 186:n.trans.set_next(187);break;case 187:n.trans.set_next(188);break;case 188:n.trans.set_next(189)}else switch(n.frame.N){case 180:n.trans.set_next(185),n.trans.set_wait(1);break;case 186:n.trans.set_next(191)}break;case"fell_onto_ground":case"fall_onto_ground":var s=n.ps;if(n.mech.speed()>i.character.bounceup.limit.xy||s.vy>i.character.bounceup.limit.y){s.vy=-i.character.bounceup.y,s.vx*=i.character.bounceup.factor.x,s.vz*=i.character.bounceup.factor.z;if(180<=n.frame.N&&n.frame.N<=185)return 185;if(186<=n.frame.N&&n.frame.N<=191)return 191}else{if(180<=n.frame.N&&n.frame.N<=185)return 230;if(186<=n.frame.N&&n.frame.N<=191)return 231}n.caught_throwinjury&&(n.health.hp-=n.caught_throwinjury,n.caught_throwinjury=null)}},14:function(e,t){var n=this;switch(e){case"state_entry":n.health.fall=0,n.health.bdefend=0}},15:function(e,t){var n=this;switch(e){case"frame":switch(n.frame.N){case 19:n.hold.obj&&n.hold.obj.type==="heavyweapon"&&n.trans.set_next(12);break;case 215:n.trans.inc_wait(-1);break;case 219:switch(n.frame.PN){case 105:n.mech.unit_friction();break;case 216:case 90:case 91:n.trans.inc_wait(-1)}}break;case"TU":n.frame.N===219&&n.frame.PN===216&&n.mech.unit_friction();break;case"fall_onto_ground":n.mech.linear_friction(r.lookup(i.friction.fell,n.ps.vx),r.lookup(i.friction.fell,n.ps.vz));break;case"combo":if(n.frame.N===215){if(t==="def")return n.trans.frame(102,10),1;if(t==="jump"){var s=0;return n.con.state.left&&(s-=1),n.con.state.right&&(s+=1),s?(n.trans.frame(213,10),n.switch_dir_fun(s===1?"right":"left")):(n.trans.inc_wait(2,10,99),n.trans.set_next(210,10)),1}}}},16:function(e,t){var n=this;switch(e){}},x:function(e,t){var n=this;switch(e){}}},o={0:!0,1:!0,2:!1,3:!1,4:!0,5:!0,6:!1,7:!0,8:!1,9:!1,10:!1,11:!1,12:!1,13:!0,14:!1,15:!1,16:!1};return u.prototype=new e,u.prototype.constructor=u,u.prototype.hit=function(e,t,n,s){function c(){e.fall!==undefined?o.health.fall+=e.fall:o.health.fall+=i.default.fall.value;var t=o.health.fall;0<t&&t<=20?o.trans.frame(220,20):20<t&&t<=40&&o.ps.y<0?h():20<t&&t<=40?o.trans.frame(o.match.random()<.5?222:224,20):40<t&&t<=60?o.trans.frame(226,20):i.fall.KO<t&&h()}function h(){e.dvy===undefined&&(o.effect.dvy=i.default.fall.dvy),o.health.fall=0;var t=n.x>o.ps.x==(o.ps.dir==="right");t&&e.dvx<0&&e.bdefend>=60?o.trans.frame(186,20):t?o.trans.frame(180,20):t||o.trans.frame(186,20),o.proper(o.effect_id(f),"drop_weapon")&&o.drop_weapon(o.effect.dvx,o.effect.dvy)}var o=this,u=!1;if(o.cur_state()===10){o.catching.caught_cpointhurtable()&&(o.itr.lasthit=0,u=!0,c());if(o.catching.caught_cpointhurtable()!==0||o.catching===t){o.itr.lasthit=0,u=!0,o.health.hp-=Math.abs(e.injury);if(e.injury>0){o.effect_create(0,i.effect.duration);var a;e.vaction?a=e.vaction:a=n.x>o.ps.x==(o.ps.dir==="right")?o.frame.D.cpoint.fronthurtact:o.frame.D.cpoint.backhurtact,o.trans.frame(a,20)}}}else if(o.cur_state()!==14){o.itr.lasthit=0,u=!0,o.effect.dvx=e.dvx?t.dirh()*(e.dvx-1):0,o.effect.dvy=e.dvy?e.dvy:0;var f=e.effect!==undefined?e.effect:i.default.effect.num;o.cur_state()===7&&n.x>o.ps.x==(o.ps.dir==="right")?(e.injury&&(o.health.hp-=i.defend.injury.factor*e.injury),e.bdefend&&(o.health.bdefend+=e.bdefend),o.health.bdefend>i.defend.break_limit?(o.trans.frame(112,20),o.effect.dvx&&(o.effect.dvx-=r.lookup(i.defend.break_absorb,o.effect.dvx))):o.trans.frame(111,20)):(o.hold.obj&&o.hold.obj.type==="heavyweapon"&&o.drop_weapon(0,0),e.injury&&(o.health.hp-=e.injury),o.health.bdefend=45,c());var l=i.effect.duration-1;switch(o.trans.next()){case 111:l=3;break;case 112:l=4}o.effect_create(f,l),o.visualeffect_create(f,s,n.x<o.ps.x,o.health.fall>0?1:2)}return u},u.prototype.pre_interaction=function(){var e=this,t=n.make_array(e.trans.next_frame_D().itr);for(var r in t){var i=t[r],s=e.mech.volume(i),o=e.scene.query(s,e,{tag:"body"});switch(i.kind){case 1:case 3:for(var u in o)if(o[u].team!==e.team&&o[u].type==="character"&&(i.kind===1&&o[u].cur_state()===16||i.kind===3)&&e.itr_rest_test(o[u].uid,i)){var a=o[u].caught_a(i,e,{x:e.ps.x,y:e.ps.y,z:e.ps.z});if(a){e.itr_rest_update(o[u].uid,i),a==="front"?e.trans.frame(i.catchingact[0],10):e.trans.frame(i.catchingact[1],10),e.catching=o[u];break}}break;case 7:if(!e.con.state.att)break;case 2:for(var u in o)if(o[u].type==="lightweapon"||o[u].type==="heavyweapon")if(o[u].pick(e)){e.itr_rest_update(o[u].uid,i),i.kind===2&&(o[u].type==="lightweapon"?e.trans.frame(115,10):o[u].type==="heavyweapon"&&e.trans.frame(116,10)),e.hold.obj=o[u],e.hold.id=e.hold.obj.id;break}}}},u.prototype.post_interaction=function(){var e=this,t=n.make_array(e.frame.D.itr);for(var r in t){var s=t[r],o=e.mech.volume(s),u=e.scene.query(o,e,{tag:"body"});switch(s.kind){case 0:for(var a in u){var f=!0;u[a].type==="character"&&u[a].team===e.team&&(f=!1);if(f&&e.itr_rest_test(u[a].uid,s)&&u[a].hit(s,e,{x:e.ps.x,y:e.ps.y,z:e.ps.z},o)){e.itr_rest_update(u[a].uid,s);switch(e.frame.N){case 86:case 87:e.effect_stuck(2),e.trans.inc_wait(1);break;case 91:e.effect_stuck(2);break;default:e.effect_stuck(i.itr.hit_stall)}if(s.arest)break}}}}},u.prototype.wpoint=function(){var e=this;if(e.hold.obj&&e.frame.D.wpoint){var t=e.hold.obj.act(e,e.frame.D.wpoint,e.mech.make_point(e.frame.D.wpoint));t.thrown&&(e.hold.obj=null,e.hold.id=0),t.hit!==null&&t.hit!==undefined&&(e.itr_rest_update(t.hit,t),e.trans.inc_wait(i.itr.hit_stall,10))}},u.prototype.drop_weapon=function(e,t){var n=this;n.hold.obj&&(n.hold.obj.drop(e,t),n.hold.obj=null,n.hold.id=0)},u.prototype.vol_itr=function(e){var t=this;return t.frame.D.itr?t.mech.body(t.frame.D.itr,function(t){return t.kind==e}):[]},u.prototype.caught_a=function(e,t,n){var r=this;if(r.cur_state()===16)return n.x>r.ps.x==(r.ps.dir==="right")?r.trans.frame(e.caughtact[0],20):r.trans.frame(e.caughtact[1],20),r.health.fall=0,r.catching=t,r.drop_weapon(),n.x>r.ps.x==(r.ps.dir==="right")?"front":"back"},u.prototype.caught_b=function(e,t,n){var r=this;r.caught_b_holdpoint=e,r.caught_b_cpoint=t,r.caught_b_adir=n},u.prototype.caught_cpointkind=function(){var e=this;return e.frame.D.cpoint?e.frame.D.cpoint.kind:0},u.prototype.caught_cpointhurtable=function(){var e=this;return e.frame.D.cpoint&&e.frame.D.cpoint.hurtable!==undefined?e.frame.D.cpoint.hurtable:i.default.cpoint.hurtable},u.prototype.caught_throw=function(e,t){var n=this;e.vaction!==undefined?n.trans.frame(e.vaction,20):n.trans.frame(i.default.cpoint.vaction,20),n.caught_throwinjury=e.throwinjury,n.caught_throwz=t},u.prototype.caught_release=function(){var e=this;e.catching=0,e.trans.frame(181,20),e.effect.dvx=3,e.effect.dvy=-3,e.effect.timein=-1,e.effect.timeout=0},u}),define("LF/weapon",["LF/livingobject","LF/global","F.core/util"],function(e,t,n){function i(t){function s(n,r,s){var o=this;e.call(this,n,r,s),o.type=t,o.states=i,o.setup()}var i={generic:function(e,t){var n=this;switch(e){case"TU":n.interaction();switch(n.cur_state()){case 1001:case 2001:break;default:n.mech.dynamics()}var i=n.ps;i.y===0&&i.vy>0&&(n.heavy&&this.mech.speed()>r.weapon.bounceup.limit?(i.vy=r.weapon.bounceup.speed.y,i.vx*=r.weapon.bounceup.factor.x,i.vz*=r.weapon.bounceup.factor.z):(n.team=0,i.vy=0,n.light&&n.trans.frame(70),n.heavy&&n.trans.frame(21),n.health.hp-=n.data.bmp.weapon_drop_hurt),i.zz=0)}},1004:function(e,t){var n=this;switch(e){case"frame":n.frame.N===64&&(n.team=0)}},2e3:function(e,t){var n=this;switch(e){case"frame":n.frame.N===21&&n.trans.set_next(20)}},2004:function(e,t){var n=this;switch(e){case"frame":n.frame.N===20&&(n.team=0)}}};return s.prototype=new e,s.prototype.constructor=s,s.prototype.light=t==="lightweapon",s.prototype.heavy=t==="heavyweapon",s.prototype.interaction=function(){var e=this,t=n.make_array(e.frame.D.itr);if(e.team!==0)if(e.heavy||e.light&&e.cur_state()===1002)for(var i in t)if(t[i].kind===0){var s=e.mech.volume(t[i]),o=e.scene.query(s,e,{tag:"body",not_team:e.team});for(var u in o){var a;t[i].arest!==undefined||t[i].vrest!==undefined?a=t[i]:a=r.default.weapon,a.arest&&(a.arest+=20);if(e.itr_rest_test(o[u].uid,a)&&o[u].hit(t[i],e,{x:e.ps.x,y:e.ps.y,z:e.ps.z},s)){var f=e.ps,l=f.vx===0?0:f.vx>0?1:-1;e.light&&(f.vx=l*r.weapon.hit.vx,f.vy=r.weapon.hit.vy),e.itr_rest_update(o[u],o[u].uid,a),e.light&&(e.effect.timeout=2),e.heavy&&(e.effect.timeout=4),e.effect.dvx=0,e.effect.dvy=0,e.effect.stuck=!0}}}},s.prototype.hit=function(e,t,n,i){var s=this;if(s.holder)return!1;var o=!1;if(s.light)if(s.cur_state()===1002)o=!0,t.dirh()>0!=s.ps.vx>0&&(s.ps.vx*=r.weapon.reverse.factor.vx),s.ps.vy*=r.weapon.reverse.factor.vy,s.ps.vz*=r.weapon.reverse.factor.vz;else if(s.cur_state()===1004){o=!0;var u=t.mech.speed();s.ps.vx=u*r.weapon.gain.factor.x*(t.ps.vx>0?1:-1),s.ps.vy=u*r.weapon.gain.factor.y}var a=e.fall!==undefined?e.fall:r.default.fall.value;if(s.heavy)if(s.cur_state()===2004){o=!0;if(t.type==="character")a<r.fall.KO?s.ps.vy=r.weapon.soft_bounceup.speed.y:s.ps.vy=r.weapon.bounceup.speed.y;else{var u=t.mech.speed();s.ps.vx=u*r.weapon.gain.factor.x*(t.ps.vx>0?1:-1),s.ps.vy=u*r.weapon.gain.factor.y}}else s.cur_state()===2e3&&a>=r.fall.KO&&(o=!0,t.dirh()>0!=s.ps.vx>0&&(s.ps.vx*=r.weapon.reverse.factor.vx),s.ps.vy*=r.weapon.reverse.factor.vy,s.ps.vz*=r.weapon.reverse.factor.vz);return o&&(s.team=t.team,s.visualeffect_create(0,i,n.x<s.ps.x,a<r.fall.KO?1:2)),o},s.prototype.act=function(e,t,i){var s=this,o=s.frame.D,u={};s.data.frame[t.weaponact]&&(s.trans.frame(t.weaponact),s.trans.trans());if(o.wpoint&&o.wpoint.kind===2){t.dvx&&(s.ps.vx=e.dirh()*t.dvx),t.dvz&&(s.ps.vz=e.dirv()*t.dvz),t.dvy&&(s.ps.vy=t.dvy);if(s.ps.vx||s.ps.vy||s.ps.vz){var a,f;s.light&&(a=73,f=-23),s.heavy&&(a=48,f=-40),s.mech.set_pos(e.ps.x+e.dirh()*a,e.ps.y+f,e.ps.z+s.ps.vz),s.ps.zz=1,s.light&&s.trans.frame(40),s.heavy&&s.trans.frame(999),s.trans.trans(),s.holder=null,u.thrown=!0}if(!u.thrown){var l=t.cover!==undefined?t.cover:r.default.wpoint.cover;l===1?s.ps.zz=-1:s.ps.zz=0,s.switch_dir_fun(e.ps.dir),s.ps.sz=s.ps.z=e.ps.z,s.mech.coincideXY(i,s.mech.make_point(o.wpoint)),s.mech.project()}if(s.light&&t.attacking){var c=n.make_array(o.itr);for(var h in c)if(c[h].kind===5){var p=s.mech.volume(c[h]),d=s.scene.query(p,[s,e],{tag:"body",not_team:s.team});for(var v in d)if(s.itr_rest_test(d[v].uid,c[h])&&e.itr_rest_test(d[v].uid,c[h])){s.itr_rest_update(d[v],d[v].uid,c[h]);var m;s.data.weapon_strength_list&&s.data.weapon_strength_list[t.attacking]?m=s.data.weapon_strength_list[t.attacking]:m=c[h],d[v].hit(m,e,{x:e.ps.x,y:e.ps.y,z:e.ps.z},p)&&(m.vrest&&(u.vrest=m.vrest),m.arest&&(u.arest=m.arest),u.hit=d[v].uid)}}}}return u},s.prototype.drop=function(e,t){var n=this;n.team=0,n.holder=null,e&&(n.ps.vx=e*.5),t&&(n.ps.vy=t*.2),n.ps.zz=0,n.trans.frame(999)},s.prototype.pick=function(e){var t=this;return t.holder?!1:(t.holder=e,t.team=e.team,!0)},s.prototype.itr_rest_update=function(e,t,n){var i=this,s;n.arest?s=n.arest:n.vrest?s=n.vrest:s=r.default.weapon.vrest;if(e.type==="heavyweapon"||e.type==="lightweapon")s*=2;i.itr.vrest[t]=s},s.prototype.vol_itr=function(e){var t=this;return t.frame.D.itr?t.mech.body(t.frame.D.itr,function(t){return t.kind==e}):[]},s}var r=t.gameplay;return i}),define("F.core/effects-pool",[],function(){function e(e){this.pool=[],this.S=0,this.E=0,this.full=!1,this.config=e,this.livecount=0,e.new_arg?e.new_arg instanceof Array?this.new_arg=e.new_arg:this.new_arg=[e.new_arg]:this.new_arg=[];for(var t=0;t<e.init_size;t++)this.pool[t]=e.construct(),this.pool[t].parent=this}return e.prototype.create=function(){if(this.full){if(!(this.pool.length+this.config.batch_size<=this.config.max_size))return!1;var e=[this.E,0];for(var t=0;t<this.config.batch_size;t++)e[t+2]=this.config.construct(),e[t+2].parent=this;this.pool.splice.apply(this.pool,e),this.S!==0&&(this.S+=this.config.batch_size),this.full=!1}this.E<this.pool.length?this.E++:this.E=1;if(this.E===this.S||this.S===0&&this.E===this.pool.length)this.full=!0;return this.pool[this.E-1].born&&this.pool[this.E-1].born.apply(this.pool[this.E-1],arguments),this.livecount++,this.pool[this.E-1]},e.prototype.die=function(){if(this.livecount>0){var e=this.S;return this.pool[this.S].die&&this.pool[this.S].die.apply(this.pool[this.S],arguments),this.S<this.pool.length-1?this.S++:this.S=0,this.full=!1,this.livecount--,this.pool[e]}console.log("die too much!")},e.prototype.for_each=function(e){if(this.livecount!==0)if(this.S<this.E){for(var t=this.S;t<this.E;t++)if(e(this.pool[t])==="break")break}else{for(var n=this.S;n<this.pool.length;n++)if(e(this.pool[n])==="break")return;for(var t=0;t<this.E;t++)if(e(this.pool[t])==="break")return}},e.prototype.call_each=function(e){if(this.pool[0][e]){var t=Array.prototype.slice.call(arguments,1);this.for_each(function(n){n[e].apply(n,t)})}},e}),define("LF/effects",["LF/global","LF/sprite","F.core/effects-pool"],function(e,t,n){function r(e,t,r){this.efs={};for(var s=0;s<t.length;s++)var o={init_size:5,batch_size:5,max_size:30,construct:function(){return new i(e,t[s],r[s])}},u=this.efs[r[s]]=new n(o)}function i(e,n,r){this.dat=n,this.type=n.effect_list,this.id=r,this.sp=new t(this.dat.bmp,e.stage),this.sp.hide(),this.frame,this.frameD,this.wait=-1,this.next}return r.prototype.destroy=function(){for(var e in this.efs)this.efs[e].destroy()},r.prototype.create=function(e,t,n){n||(n=0),this.efs[t]&&this.efs[t].create(e,n)},r.prototype.TU=function(){for(var e in this.efs)this.efs[e].TU()},r.prototype.transit=function(){},n.prototype.TU=function(){this.for_each(function(e){e.TU()})},n.prototype.destroy=function(){for(var e=0;e<this.pool.length;e++)this.pool[e].destroy()},i.prototype.destroy=function(){this.sp.destroy()},i.prototype.TU=function(){this.sp.show_pic(this.frameD.pic),this.wait=this.frameD.wait,this.next=this.frameD.next;if(this.wait===0){if(this.next===999)this.next=0;else if(this.next===1e3){this.sp.hide(),this.parent.die();return}this.frame=this.next,this.frameD=this.dat.frame[this.frame]}else this.wait--},i.prototype.transit=function(){},i.prototype.set_pos=function(e,t,n){},i.prototype.born=function(e,t){var n;this.type[t]&&this.type[t].frame?n=this.type[t].frame:n=0,this.frame=n,this.frameD=this.dat.frame[this.frame];var r=e.x-this.frameD.centerx,i=e.y-this.frameD.centery,s=e.z;this.sp.set_x_y(r,i+s),this.sp.set_z(s+1),this.sp.show_pic(this.frameD.pic),this.sp.show()},r}),define("LF/factories",["LF/character","LF/weapon","LF/effects"],function(e,t,n){return{character:e,lightweapon:t("lightweapon"),heavyweapon:t("heavyweapon"),effects:n}}),define("F.core/collision",["F.core/math"],function(e){return{rect:function(e,t){return e.bottom<t.top?!1:e.top>t.bottom?!1:e.right<t.left?!1:e.left>t.right?!1:!0},normalize_rect:function(e){return e.left>e.right&&e.top>e.bottom?{left:e.right,right:e.left,top:e.bottom,bottom:e.top}:e.left>e.right?{left:e.right,right:e.left,top:e.top,bottom:e.bottom}:e.top>e.bottom?{left:e.left,right:e.right,top:e.bottom,bottom:e.top}:e},tri:function(t,n){function o(){var e=s;return s+=4,i[e]!=i[e+1]&&i[e+2]!=i[e+3]}var r=e.signed_area,i=[],s=0;i.push(r(t[0],t[1],n[0])>0,r(t[0],t[1],n[1])>0,r(t[0],n[0],n[1])>0,r(t[1],n[0],n[1])>0);if(o())return!0;i.push(i[1],r(t[0],t[1],n[2])>0,r(t[0],n[1],n[2])>0,r(t[1],n[1],n[2])>0);if(o())return!0;i.push(i[0],i[5],r(t[0],n[0],n[2])>0,r(t[1],n[0],n[2])>0);if(o())return!0;i.push(r(t[1],t[2],n[0])>0,r(t[1],t[2],n[1])>0,i[3],r(t[2],n[0],n[1])>0);if(o())return!0;i.push(i[13],r(t[1],t[2],n[2])>0,i[7],r(t[2],n[1],n[2])>0);if(o())return!0;i.push(i[12],i[17],i[11],r(t[2],n[0],n[2])>0);if(o())return!0;i.push(r(t[0],t[2],n[0])>0,r(t[0],t[2],n[1])>0,i[2],i[15]);if(o())return!0;i.push(i[25],r(t[0],t[2],n[2])>0,i[6],i[19]);if(o())return!0;i.push(i[24],i[29],i[10],i[23]);if(o())return!0;var u=[i[2]==i[6]&&i[6]==!i[10],i[3]==i[7]&&i[7]==!i[11],i[15]==i[19]&&i[19]==!i[23]],a=[i[0]==i[12]&&i[12]==!i[24],i[1]==i[13]&&i[13]==!i[25],i[9]==i[21]&&i[21]==!i[33]];return u[0]&&u[1]&&u[2]?!0:a[0]&&a[1]&&a[2]?!0:!1},circle:function(t,n){return e.distance(t.center,n.center)<=t.radius+n.radius},line:function(t,n,r,i){var s=e.signed_area(t,n,r)>0!=e.signed_area(t,n,i)>0&&e.signed_area(r,i,t)>0!=e.signed_area(r,i,n)>0;return s},point_in_rect:function(t,n){return e.inbetween(t.x,n.left,n.right)&&e.inbetween(t.y,n.top,n.bottom)}}}),define("LF/scene",["F.core/util","F.core/collision"],function(e,t){function r(e){this.live={}}var n=0;return r.prototype.add=function(e){return e.uid=n++,this.live[e.uid]=e,e.uid},r.prototype.remove=function(e){delete this.live[e.uid],e.uid=-1},r.prototype.query=function(t,n,r){var i=[],s=r.tag;s||(s="body");var o=0,u=s.indexOf(":");u!==-1&&(o=s.slice(u+1),s=s.slice(0,u)),n=e.make_array(n);for(var a in this.live){var f=!1;for(var l in n)if(this.live[a]===n[l]){f=!0;break}if(f)continue;if(r.not_team&&this.live[a].team===r.not_team)continue;if(r.type&&this.live[a].type!==r.type)continue;if(r.filter&&!r.filter(this.live[a]))continue;if(this.live[a]["vol_"+s]){var c=this.live[a]["vol_"+s](o);for(var h=0;h<c.length;h++)if(this.intersect(t,c[h])){i.push(this.live[a]);break}}}return i},r.prototype.intersect=function(e,n){var r={left:e.x+e.vx,top:e.y+e.vy,right:e.x+e.vx+e.w,bottom:e.y+e.vy+e.h},i={left:n.x+n.vx,top:n.y+n.vy,right:n.x+n.vx+n.w,bottom:n.y+n.vy+n.h};return t.rect(r,i)&&t.rect({left:e.z-e.zwidth,top:0,right:e.z+e.zwidth,bottom:1},{left:n.z-n.zwidth,top:0,right:n.z+n.zwidth,bottom:1})},r.prototype.distance=function(e,t){var n=e.x+e.centerx-(t.x+t.centerx),r=e.y-t.y,i=e.z+e.centery-(t.z+t.centery);return Math.sqrt(n*n+r*r+i*i)},r}),define("LF/third_party/random",[],function(){function e(){this.next=function(){return this.x==0&&this.x==-1,this.y==0&&this.y==-1,this.x=this.nextX(),this.y=this.nextY(),((this.x<<16)+(this.y&65535))/4294967295+.5},this.nextX=function(){return 36969*(this.x&65535)+(this.x>>16)},this.nextY=function(){return 18273*(this.y&65535)+(this.y>>16)},this.nextInt=function(t,n){return n||(t=0,n=4294967295),Math.floor(this.next()*(n-t))+t},this.seed=function(e){this.x=e*3253,this.y=this.nextX()},this.seed2d=function(t,n){this.x=t*2549+n*3571,this.y=n*2549+t*3571},this.seed3d=function(t,n,r){this.x=t*2549+n*3571+r*3253,this.y=t*3253+n*2549+r*3571},this.seed_bytime=function(){var e=(new Date).getTime();return this.seed(e),e}}return e}),define("LF/match",["F.core/util","F.core/controller","LF/factories","LF/scene","LF/third_party/random","LF/util"],function(e,t,n,r,i,s){function o(t){var n=this;n.stage=t.stage,n.state=t.state,n.data=t.package.data,n.spec=t.package.properties,n.grouped_object=e.group_elements(n.data.object,"type"),n.config=t.config,n.config||(n.config={}),n.time}return o.prototype.create=function(e){var t=[];for(var n=0;n<e.player.length;n++)t.push(e.player[n].id);e.set||(e.set={});var i=this;this.data.object.load(t,function(){i.scene=new r,i.effects=i.create_effects(i.config.effects),i.character=i.create_characters(e.player),i.randomseed=i.new_randomseed(),i.control=i.create_controller(e.control),i.lightweapon=[],i.heavyweapon=[],i.drop_weapons(e.set.weapon),i.create_timer()})},o.prototype.destroy=function(){var e=this;e.time.paused=!0,clearInterval(e.time.timer),e.for_all("destroy");var t=e.stage;while(t.lastChild)t.removeChild(t.lastChild)},o.prototype.create_timer=function(){var e=this;e.time={t:0,paused:!1,timer:null,$fps:document.getElementById("fps")},e.time.timer=setInterval(function(){e.frame()},1e3/30.5)},o.prototype.frame=function(){var e=this;e.control&&e.control.fetch(),e.time.paused?e.time.$fps&&(e.time.$fps.value="paused"):(e.TU_trans(),e.calculate_fps(1)),e.time.t===0&&e.emit_event("start"),e.time.t++},o.prototype.TU_trans=function(){var e=this;e.emit_event("transit"),e.for_all("transit"),e.emit_event("TU"),e.for_all("TU")},o.prototype.emit_event=function(e){var t=this;t.state&&t.state.event&&t.state.event.call(this,e)},o.prototype.for_all=function(e){var t=this;for(var n=0;n<t.character.length;n++)t.character[n][e]();for(var n=0;n<t.lightweapon.length;n++)t.lightweapon[n][e]();for(var n=0;n<t.heavyweapon.length;n++)t.heavyweapon[n][e]();t.effects[e]()},o.prototype.calculate_fps=function(e){var t=this;if(t.time.$fps){var n=t.time.time;t.time.time=(new Date).getTime();var r=t.time.time-n;t.time.$fps.value=Math.round(1e3/r*e)+"fps"}},o.prototype.create_characters=function(e){var t=this,r=[{x:400,y:0,z:200},{x:300,y:0,z:200},{x:200,y:0,z:200},{x:500,y:0,z:200}],i=[],o={spec:t.spec,controller:null,match:t,stage:t.stage,scene:t.scene,effects:t.effects,team:0};for(var u=0;u<e.length;u++){var a=e[u],f=s.select_from(t.data.object,{id:a.id}).data;o.controller=a.controller,o.team=a.team;var l=i.push(new n.character(o,f,a.id));i[l-1].set_pos(r[l-1].x,r[l-1].y,r[l-1].z)}return i},o.prototype.create_effects=function(t){var r=this,i=t?t:{init_size:20};i.match=r,i.stage=r.stage;var s=e.extract_array(r.grouped_object.effects,["data","id"]);return new n.effects(i,s.data,s.id)},o.prototype.create_random=function(){},o.prototype.drop_weapons=function(e){var t=this;e&&(t.create_weapon(100,{x:100,y:-800,z:200}),t.create_weapon(101,{x:500,y:-800,z:200}),t.create_weapon(150,{x:400,y:-800,z:250}))},o.prototype.create_weapon=function(t,r){var i=this,s=t<150?"lightweapon":"heavyweapon",o={spec:i.spec,match:i,stage:i.stage,scene:i.scene,effects:i.effects},u=e.arr_search(i.grouped_object[s],function(e){return e.id===t}),a=i.grouped_object[s][u],f=new n[s](o,a.data,a.id);f.set_pos(r.x,r.y,r.z),i[s].push(f)},o.prototype.periodic_event=function(e){},o.prototype.new_randomseed=function(){var e=new i;return e.seed_bytime(),e},o.prototype.random=function(){return this.randomseed.next()},o.prototype.create_controller=function(e){var n=this;if(e==="debug"){var r={0:"0",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",ctrl:"ctrl"},i=new t(r);return i.child.push({key:function(e,t){if(t)switch(e){case"1":n.time.paused?n.time.paused=!1:n.time.paused=!0;break;case"2":n.time.paused?n.TU_trans():n.time.paused=!0}}}),i.sync=!0,i}},o}),requirejs(["F.core/sprite","F.core/util","F.core/math","F.core/css!LF/tools/tools.css","LF/sprite","LF/loader!packages","LF/match","LF/util","test_cases"],function(e,t,n,r,i,s,o,u,a){function d(){var e=this;e.state={up:0,down:0,left:0,right:0,def:0,jump:0,att:0},e.config=null,e.child=[],e.sync=!0,e.seq=null,e.t=0}function v(e){var t=this;t.control=[];var n=[];t.num_player=e.scenario.player.length;for(var r=0;r<t.num_player;r++)t.control[r]=new d,n[r]={controller:t.control[r],id:e.scenario.player[r].id,team:e.scenario.player[r].team};t.match=new o({stage:c,state:{event:function(e){t.event(e)}},config:null,"package":s}),t.match.create({player:n,control:null,set:{weapon:null}}),t.cases=e.cases,t.cur_case=t.cases.length,t.next_case()}function m(e){e.parentNode.removeChild(e)}function g(e,t,n,r){var i=Math.round(t*10)/10;e.innerHTML+=(i>0&&n?"+":"")+i,r!==undefined&&i>r&&(e.style.backgroundColor="#F00")}function y(e,t){var n=Math.round(t*10)/10;e.innerHTML="&Delta;="+n,e.style.color="#FFF",t<=10?e.style.backgroundColor="#0D0":e.style.backgroundColor="#F00"}function b(e,t){e.innerHTML+=" <span class='errorlabel'>"+t+"</span>"}function w(e,t){var n=Math.round(t*10)/10;n&&(e.innerHTML+=" <span class='errorlabel'>"+(n>0?"+":"")+n+"</span>")}function E(){function e(e,t,n,r){var i=document.createElement(t);return e.appendChild(i),n&&(i.id=n),r&&(i.classname=r),i}function t(t,n){var r=e(t,"td");return n!==null&&n!==undefined&&(r.innerHTML=typeof n=="string"?n:JSON.stringify(n)),r}function r(){n++,n===a.length&&setTimeout(function(){S()},10)}var n=0;for(var o=0;o<a.length;o++)(function(n){var o=a[n].scenario.player,f=o.length,c=e(l,"div",null,"scenario"),h=[];for(var p=0;p<f;p++)h.push(o[p].id);s.data.object.load(h,function(){for(var l=0;l<f;l++)o[l].data=u.select_from(s.data.object,{id:o[l].id}).data;for(var h=0;h<a[n].cases.length;h++){var p=a[n].cases[h];p.result_table=[];var d=p.player[0].length;for(var v=1;v<f;v++)p.player[v].length>d&&(d=p.player[v].length);p.duration=d;for(var l=0;l<f;l++){if(!p.player[l])continue;var m=p.result_table[l]=[],g=e(c,"table"),y=e(g,"tr"),b=e(g,"tr"),w=e(g,"tr"),E=e(g,"tr"),S=e(g,"tr"),x=e(g,"tr"),T=e(g,"tr"),N=e(g,"tr"),C=e(g,"tr"),k=e(g,"tr");m.r_fr=x,m.r_dx=T,m.r_dy=N,m.r_tr=C;var L=t(y,"S"+(n+1)+".C"+(h+1)+".Ch"+(l+1));L.colSpan=2,L.style.width="100px",t(b,"pic").colSpan=2,t(w,"state").colSpan=2,t(E,"key").colSpan=2,t(S),t(x,"frame"),t(T,"dx"),t(N,"dy"),t(C,"path <i>E&#772;</i>"),t(k,"total"),t(y,l>0?null:p.name).colSpan=99,t(S,"sum"),m.errorsum_fr=t(x),m.errorsum_dx=t(T),m.errorsum_dy=t(N),m.errorsum_tr=t(C),m.errorsum_all=t(k),t(S).colSpan=99,t(k).colSpan=99;for(var A=0;A<d;A++){var O=p.player[l][A];if(!O)continue;var M=o[l].data,_=t(b);if(O.f!==undefined){var D=M.frame[O.f instanceof Array?O.f[0]:O.f];_.style.position="relative",_.style.width=M.bmp.file[0].w+1+"px",_.style.height=M.bmp.file[0].h+1+"px";var P=new i(M.bmp,_);P.show_pic(D.pic),P.set_x_y(0,0)}t(w,O.f!==undefined?D.state:undefined),t(E,O.k),m[A]={f:t(x,O.f),dx:t(T,O.dx),dy:t(N,O.dy),tr:t(C)}}}}r()})})(o)}function S(){x()}function x(){f--,f<0?c.style.display="none":new v(a[f])}(function(){var e="<div class='Fbar'>F.LF/unit test suite <a href='../docs/unit_test_suite.html'>Help</a></div><div id='overall'></div><div id='stage' class='canvas'></div><div id='data'></div>",t=document.createElement("div");t.innerHTML=e;var n=document.getElementsByTagName("body")[0];n.insertBefore(t,n.firstChild)})(),u.setup_resourcemap(s,e);var a=a.test_cases,f=a.length,l=document.getElementById("data"),c=document.getElementById("stage"),h=10,p={passing_cases:0,finished_cases:0,delta:0};d.prototype.clear_states=function(){},d.prototype.fetch=function(){var e=this;if(!e.seq)return;if(e.t>=e.seq.length)return;if(e.t>0&&e.seq[e.t-1].k){var n=t.make_array(e.seq[e.t-1].k);for(var r=0;r<n.length;r++)for(var i=0;i<e.child.length;i++)if(n[r].indexOf("hold ")===0){var s=n[r].slice(5);e.state[s]=0,e.child[i].key(s,0)}}if(e.t>=0&&e.seq[e.t].k){var n=t.make_array(e.seq[e.t].k);for(var r=0;r<n.length;r++)for(var i=0;i<e.child.length;i++)if(n[r].indexOf("hold ")===0){var s=n[r].slice(5);e.child[i].key(s,1),e.state[s]=1}else if(n[r].indexOf("longhold ")===0){var s=n[r].slice(9);e.child[i].key(s,1),e.state[s]=1}else if(n[r].indexOf("release ")===0){var s=n[r].slice(8);e.child[i].key(s,0),e.state[s]=0}else e.child[i].key(n[r],1),e.state[n[r]]=1,e.child[i].key(n[r],0),e.state[n[r]]=0}},d.prototype.flush=function(){},d.prototype.frame=function(){var e=this;e.t++},d.prototype.assign=function(e){var t=this;t.seq=e,t.t=-h},v.prototype.next_case=function(){var e=this;e.cur_case--;if(e.cur_case<0)e.match.destroy(),x();else{e.ccase=e.cases[e.cur_case],e.duration=e.ccase.duration,e.result=[],e.mem=[];for(var t=0;t<e.num_player;t++)e.control[t].assign(e.ccase.player[t]),e.result[t]=[],e.mem[t]={};e.t=-h}},v.prototype.event=function(e){var t=this;if(e==="TU"){t.t===-h&&typeof t.ccase.setup=="function"&&t.ccase.setup(t.match),t.t++;for(var n=0;n<t.num_player;n++)t.control[n].frame()}if(e==="transit"){if(t.t>=0&&t.t<t.duration)for(var n=0;n<t.num_player;n++)t.result[n][t.t]={},t.ccase.player[n]&&t.ccase.player[n][t.t]&&t.test(t.match.character[n],t.ccase.player[n][t.t],t.result[n][t.t],t.mem[n]);t.t===t.duration&&(t.show_result(),t.next_case())}},v.prototype.test=function(e,r,i,s){function u(e,n){return n instanceof Array?t.search_array(n,function(t){return t===e})!==-1:e===n}var o=this;if(e.frame.N===230)var a;r.f!==undefined&&(u(e.frame.N,r.f)?i.f="no error":i.f=e.frame.N),o.t===0?(s.ps={x:0,y:0},s.psl={x:0,y:0},s.pso={x:e.ps.x,y:e.ps.y}):o.t>=1&&(r.dx!==undefined&&(i.dx=e.ps.x-s.psl.x-r.dx,s.ps.x+=r.dx),r.dy!==undefined&&(i.dy=e.ps.y-s.psl.y-r.dy,s.ps.y+=r.dy),i.tr=n.distance(n.sub(e.ps,s.pso),s.ps)),s.psl.x=e.ps.x,s.psl.y=e.ps.y},v.prototype.show_result=function(){var e=this;for(var t=0;t<e.num_player;t++){var n=0,r=0,i=0,s=0,o=0,u,a,f,l=0;for(var c=0;c<e.duration;c++){var h=e.result[t][c],p=e.ccase.result_table[t][c];h.f!==undefined&&(u=!0,h.f!=="no error"&&(b(p.f,h.f),r+=1)),h.dx!==undefined&&(a=!0,i+=h.dx>0?h.dx:-h.dx,w(p.dx,h.dx)),h.dy!==undefined&&(f=!0,s+=h.dy>0?h.dy:-h.dy,w(p.dy,h.dy)),h.tr!==undefined&&(h.tr&&l++,o+=h.tr>0?h.tr:-h.tr,g(p.tr,h.tr))}u||m(e.ccase.result_table[t].r_fr),a||m(e.ccase.result_table[t].r_dx),f||m(e.ccase.result_table[t].r_dy),!a&&!f&&m(e.ccase.result_table[t].r_tr),n=r+i+s,g(e.ccase.result_table[t].errorsum_fr,r,0,0),g(e.ccase.result_table[t].errorsum_dx,i),g(e.ccase.result_table[t].errorsum_dy,s),g(e.ccase.result_table[t].errorsum_tr,l?o/l:0),y(e.ccase.result_table[t].errorsum_all,n)}e.ccase.result_table.length=0},function(){E()}()}),define("LF/tools/unit_test_suite",function(){});